<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Katalog Benih - BenihKu</title>
  <link rel="stylesheet" href="assets/css/base-style.css?v=3.0" />
  <link rel="stylesheet" href="assets/css/product-style.css" />
  <!-- <link rel="stylesheet" href="assets/css/style.css"> -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body>
  <nav class="nav-wrap container">
    <a href="index.html" class="brand">
      <img src="assets/img/logo.jpeg" alt="BenihKu logo" />BenihKu
    </a>

    <ul class="links">
      <li><a href="index.html">Beranda</a></li>
      <li><a href="products.html" class="active">Benih</a></li>
      <li><a href="services.html">Layanan</a></li>
      <li><a href="testimonials.html">Testimoni</a></li>
      <li><a href="keranjang.html">Keranjang</a></li>
      <li><a href="orders.html">Riwayat</a></li>
      <li><a href="contact.html">Kontak</a></li>

      <li class="group">
        <div class="search">
          <form action="products.html" method="get">
            <input type="checkbox" id="search-toggle" />
            <label for="search-toggle">
              <ion-icon name="search-outline"></ion-icon>
            </label>
            <input type="search" placeholder="Search..." name="q" />
          </form>
        </div>

        <a href="keranjang.html" class="icon-btn cart" aria-label="Cart">
          <ion-icon name="cart-outline"></ion-icon>
        </a>

        <div class="icon-btn menu-toggle">
          <input type="checkbox" id="menu-toggle" />
          <label for="menu-toggle" class="hamburger">
            <ion-icon name="menu-outline"></ion-icon>
          </label>
          <ul class="sub-links">
            <li><a href="index.html">Beranda</a></li>
            <li><a href="products.html" class="active">Benih</a></li>
            <li><a href="services.html">Layanan</a></li>
            <li><a href="testimonials.html">Testimoni</a></li>
            <li><a href="contact.html">Kontak</a></li>
            <!-- Auth buttons added dynamically by auth.js -->
          </ul>
        </div>
      </li>
    </ul>

    <!-- Auth panel removed - handled by auth.js -->
  </nav>
  <main>
    <header class="container">
      <h1 class="hero-title">Katalog Benih Unggulan</h1>
      <form action="products.html" method="get" class="search-form-products">
        <div class="search-box">
          <button type="submit" id="searchBtn"
            style="border:none; background:none; cursor:pointer; font-size: 1.2rem; display: flex; align-items: center;">
            <ion-icon name="search-outline"></ion-icon>
          </button>
          <input type="text" id="searchInput" name="q" class="search-input" placeholder="Cari benih..." />
          <a href="voucher.html" class="voucher"><ion-icon name="ticket-outline"></ion-icon> Voucher</a>
        </div>
      </form>
    </header>
    <section class="products container">
      <div class="product-grid" id="productGrid">
        <!-- Products will be loaded dynamically from API -->
        <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
          <p>Memuat produk...</p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 BenihKu. All Rights Reserved. Dibuat oleh Kelompok 3.</p>
    </div>
  </footer>

  <script>
    // Load products from API
    async function loadProducts(silent = false) {
      try {
        const response = await fetch(`api/products/read.php?is_active=1&t=${new Date().getTime()}`);
        const data = await response.json();

        const grid = document.getElementById('productGrid');

        if (data.success && data.data.length > 0) {
          if (!silent) grid.innerHTML = '';

          let newHtml = '';
          data.data.forEach(product => {
            const card = `
              <div class="product-card">
                <a href="detail.html?id=${product.id}" class="product-img">
                  <img src="${product.gambar}" alt="${product.nama}" onerror="this.src='assets/img/products/default.jpg'" />
                </a>
                <div class="product-info">
                  <div class="product-meta">
                    <span class="product-category">${product.kategori || 'Benih'}</span>
                    <span class="product-rating"><ion-icon name="star"></ion-icon> 4.8</span>
                  </div>
                  <a href="detail.html?id=${product.id}" class="product-title">${product.nama}</a>
                  <div class="price-group">
                    <span class="product-price">${product.harga}</span>
                  </div>
                </div>
              </div>
            `;
            newHtml += card;
          });

          if (grid.innerHTML !== newHtml) {
            grid.innerHTML = newHtml;
          }
        } else {
          grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px;"><p>Tidak ada produk tersedia.</p></div>';
        }
      } catch (error) {
        console.error('Error loading products:', error);
        document.getElementById('productGrid').innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px;"><p>Gagal memuat produk. Silakan refresh halaman.</p></div>';
      }
    }

    // Load products on page load
    loadProducts();

    // Realtime: Auto-refresh data every 5 seconds
    setInterval(() => {
      loadProducts(true); // true = silent mode
    }, 5000);
  </script>
  <!-- <script src="assets/js/Product.js"></script> -->
  <script src="assets/js/auth.js?v=2.2"></script>
</body>

</html>